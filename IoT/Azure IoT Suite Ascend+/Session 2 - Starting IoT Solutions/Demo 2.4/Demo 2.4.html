<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
</head>
<body>
<h1 id="demo-2.4-sending-messages-from-a-raspberry-pi-running-raspian">DEMO 2.4: Sending messages from a Raspberry Pi running Raspian</h1><h2 id="objectives">Objectives</h2><p>Show how a physical device can connect to the same backend and send messages. If you don’t have a device you can skip this demo.</p><h2 id="requirements">Requirements</h2><p>An active Azure subscription. If you don’t have an account, you can create a free trial account in just a couple of minutes. For details, see <a href="http://azure.microsoft.com/pricing/free-trial/" class="uri">http://azure.microsoft.com/pricing/free-trial/</a></p><p>A Raspberry Pi 2 or 3 with the latest version of Raspbian installed.</p><h2 id="setup">Setup</h2><p>You need the Remote Monitoring solution still running that you set up for Demo 2.1.</p><p>Find the Solutions folder for this presentation, then the Demo 2.4 folder, and the file mydevice.js. You’ll need this file.</p><p>If not already installed, install NPM on the Raspberry Pi. Open a command prompt and type the following:</p><ol style="list-style-type: decimal"><li><p>sudo apt-get install npm</p></li><li><p>sudo npm install -g npm@latest</p></li></ol><p>Install the Azure Node packages:</p><ol style="list-style-type: decimal"><li><p>sudo npm install -g azure-iot-device@latest</p></li><li><p>sudo npm install -g azure-iot-device-amqp@latest</p></li></ol><p>Copy the file mydevice.js to the Raspberry Pi and save the file as mydevice.js.</p><h2 id="demo-steps">Demo Steps</h2><p>In this demo, you’ll explain how to send messages using Node on a Raspberry Pi.</p><p>Let’s first create a new device.</p><ol style="list-style-type: decimal"><li><p>Head to the Remote Monitoring Web site. Click on the Devices button in the left-side menu and Add a Device at the bottom of the menu.</p><p><img src="./media/image1.png" width="262" height="710" /></p></li><li><p>Create a Custom device.</p><p><img src="./media/image2.png" width="624" height="224" /></p></li><li><p>Select Let me define my own Device ID and type a unique name. Click the Check ID button to validate that the name is unique then click Create.</p><p><img src="./media/image3.png" width="624" height="406" /></p></li><li><p>Select the newly created device and click on the Enable Device link in the right-side menu.</p><p><img src="./media/image4.png" width="624" height="214" /></p></li><li><p>Head to the Azure portal, select the resource group for the Remote Monitoring solution and select the IoT Hub from the services list.</p></li><li><p>Click on the Devices button and select the new device.</p></li><li><p>Copy the device connection string and paste as the connectionString variable value.</p><p><img src="./media/image5.png" width="569" height="335" /></p></li><li><p>Save the file.</p></li><li><p>At the command prompt type: node mydevice.js</p></li><li><p>The device is now sending telemetry to IoT Hub.</p></li><li><p>Head to the Remote Monitoring Web site, select the new device from the dropdown menu. The graph will display the telemetry.</p><p><img src="./media/image6.png" width="624" height="217" /></p></li><li><p>Press Control-C in the Raspberry Pi command prompt window to stop the node script.</p></li><li><p>This completes this demo.</p></li></ol><h2 id="teardown">Teardown</h2><p>You will still need the Remote Monitoring solution (and the parts listed in the Azure portal) for other demos so don’t delete that stuff yet.</p>
</body>
</html>
